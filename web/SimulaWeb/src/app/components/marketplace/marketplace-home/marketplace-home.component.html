<div class="marketplace-container">
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <h1 class="display-4 text-center mb-4">üõçÔ∏è Marketplace Empresarial</h1>
      <p class="lead text-center mb-5">Conecta, compra y vende productos entre negocios locales</p>
      
      <!-- Barra de b√∫squeda -->
      <div class="search-bar-container">
        <div class="input-group search-bar">
          <span class="input-group-text">
            <i class="bi bi-search"></i>
          </span>
          <input 
            type="text" 
            class="form-control" 
            [(ngModel)]="terminoBusqueda" 
            placeholder="Buscar productos, marcas o categor√≠as..." 
            (keyup.enter)="buscarProductos()">
          <button class="btn btn-primary" (click)="buscarProductos()">
            Buscar
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Categor√≠as r√°pidas -->
  <section class="categories-section py-4">
    <div class="container">
      <h2 class="h4 mb-3">Categor√≠as Populares</h2>
      <div class="categories-grid">
        <div 
          *ngFor="let categoria of categorias" 
          class="category-card"
          [class.active]="categoriaSeleccionada === categoria.id"
          (click)="categoriaSeleccionada = categoria.id; filtrarPorCategoria()">
          <i class="material-icons category-icon">{{ categoria.icono }}</i>
          <h3>{{ categoria.nombre }}</h3>
          <p>{{ categoria.descripcion }}</p>
          <span class="product-count">{{ categoria.productosCantidad }} productos</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Filtros y productos -->
  <section class="products-section py-4">
    <div class="container">
      <div class="row">
        <!-- Sidebar de filtros -->
        <div class="col-lg-3 mb-4">
          <div class="filters-card">
            <h3 class="h5 mb-3">Filtros</h3>
            
            <div class="filter-group">
              <label class="form-label">Categor√≠a</label>
              <select class="form-select" [(ngModel)]="categoriaSeleccionada" (change)="filtrarPorCategoria()">
                <option value="todas">Todas las categor√≠as</option>
                <option *ngFor="let cat of categorias" [value]="cat.id">{{ cat.nombre }}</option>
              </select>
            </div>

            <div class="filter-group">
              <label class="form-label">Ordenar por</label>
              <select class="form-select" [(ngModel)]="ordenamiento" (change)="ordenarProductos()">
                <option value="relevancia">M√°s relevantes</option>
                <option value="precio-menor">Precio: menor a mayor</option>
                <option value="precio-mayor">Precio: mayor a menor</option>
                <option value="nombre">Nombre A-Z</option>
                <option value="descuento">Mayor descuento</option>
              </select>
            </div>

            <div class="stats-info mt-4">
              <p class="mb-1"><strong>{{ productosFiltrados.length }}</strong> productos encontrados</p>
              <p class="mb-0 text-muted small">De {{ productos.length }} totales</p>
            </div>
          </div>
        </div>

        <!-- Grid de productos -->
        <div class="col-lg-9">
          <div class="products-grid">
            <div 
              *ngFor="let producto of productosFiltrados" 
              class="product-card"
              [routerLink]="['/marketplace/producto', producto.id]">
              
              <!-- Badge de descuento -->
              <div *ngIf="producto.descuento" class="discount-badge">
                -{{ producto.descuento }}%
              </div>

              <!-- Imagen del producto -->
              <div class="product-image">
                <img [src]="producto.imagen" [alt]="producto.nombre">
                <div class="product-overlay">
                  <button 
                    class="btn btn-sm btn-light quick-add"
                    (click)="agregarAlCarrito(producto, $event)">
                    <i class="bi bi-cart-plus"></i> Agregar
                  </button>
                </div>
              </div>

              <!-- Informaci√≥n del producto -->
              <div class="product-info">
                <div class="product-category">{{ producto.categoria | titlecase }}</div>
                <h3 class="product-name">{{ producto.nombre }}</h3>
                <p class="product-description">{{ producto.descripcion }}</p>
                
                <!-- Vendedor -->
                <div class="vendor-info">
                  <i class="bi bi-shop"></i>
                  <span>{{ producto.vendedor.nombre }}</span>
                  <div class="rating">
                    <i class="bi bi-star-fill"></i>
                    {{ producto.vendedor.calificacion }}
                  </div>
                </div>

                <!-- Precio -->
                <div class="product-pricing">
                  <div *ngIf="producto.descuento" class="original-price">
                    ${{ producto.precio | number:'1.2-2' }}
                  </div>
                  <div class="current-price">
                    ${{ calcularPrecioConDescuento(producto.precio, producto.descuento) | number:'1.2-2' }}
                  </div>
                </div>

                <!-- Tags -->
                <div class="product-tags">
                  <span *ngFor="let tag of producto.etiquetas" class="tag">{{ tag }}</span>
                </div>

                <!-- Caracter√≠sticas destacadas -->
                <div class="product-features">
                  <span *ngIf="producto.envioDisponible" class="feature">
                    <i class="bi bi-truck"></i> Env√≠o disponible
                  </span>
                  <span class="feature">
                    <i class="bi bi-clock"></i> {{ producto.tiempoEntrega }}
                  </span>
                  <span class="feature" [class.text-success]="producto.stock > 10" [class.text-warning]="producto.stock <= 10">
                    <i class="bi bi-box"></i> {{ producto.stock }} disponibles
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Mensaje cuando no hay productos -->
          <div *ngIf="productosFiltrados.length === 0" class="no-products">
            <i class="bi bi-search display-1 text-muted"></i>
            <h3>No se encontraron productos</h3>
            <p>Intenta con otros t√©rminos de b√∫squeda o categor√≠as</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Floating cart button -->
  <div class="floating-cart" *ngIf="carritoItems > 0">
    <a routerLink="/marketplace/carrito" class="cart-button">
      <i class="bi bi-cart3"></i>
      <span class="cart-count">{{ carritoItems }}</span>
      <span class="cart-text">Ver carrito</span>
    </a>
  </div>
</div>
