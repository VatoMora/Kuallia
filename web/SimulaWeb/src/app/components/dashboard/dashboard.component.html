<div class="container-fluid">
  <!-- Header Section -->
  <header class="hero-section mb-4" role="banner">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="display-4 mb-3">{{ getGreeting() }}, {{ currentUser.nombre }}!</h1>
          <p class="lead mb-4" *ngIf="isEmprendedor()">
            Bienvenido a tu dashboard de emprendimiento. Aquí puedes ver tu progreso y continuar con los retos.
          </p>
          <p class="lead mb-4" *ngIf="isAdmin()">
            Panel de administración del sistema Simula. Gestiona usuarios, retos y revisa estadísticas.
          </p>
        </div>
        <div class="col-md-4 text-center">
          <div class="user-avatar" style="width: 120px; height: 120px; font-size: 3rem; margin: 0 auto;" role="img" [attr.aria-label]="'Avatar de ' + currentUser.nombre">
            {{ currentUser.nombre.charAt(0) }}
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    <strong>Error:</strong> {{ error }}
    <button type="button" class="btn btn-outline-danger btn-sm float-end" (click)="refreshData()">
      Reintentar
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && !error">
    <!-- Emprendedor Dashboard -->
    <div *ngIf="isEmprendedor()">
      <div class="row mb-4">
        <!-- User Stats -->
        <div class="col-md-3">
          <div class="stats-card" role="region" aria-labelledby="nivel-heading">
            <h5 id="nivel-heading">Mi Nivel</h5>
<h2 class="text-primary" [attr.aria-label]="'Nivel actual: ' + currentUser.nivel">{{ currentUser.nivel }}</h2>
            <p class="text-muted">Nivel actual</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card" role="region" aria-labelledby="saldo-heading">
            <h5 id="saldo-heading">Mi Saldo</h5>
<h2 class="text-success" [attr.aria-label]="'Saldo disponible: ' + currentUser.saldo + ' puntos'">${{ currentUser.saldo }}</h2>
            <p class="text-muted">Puntos disponibles</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card" role="region" aria-labelledby="retos-heading">
            <h5 id="retos-heading">Retos Completados</h5>
<h2 class="text-info" [attr.aria-label]="'Retos completados: ' + progressData.retosResueltos + ' de ' + progressData.totalRetos">{{ progressData.retosResueltos }}</h2>
            <p class="text-muted">de {{ progressData.totalRetos }} total</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card" role="region" aria-labelledby="precision-heading">
            <h5 id="precision-heading">Precisión</h5>
<h2 class="text-warning" [attr.aria-label]="'Precisión: ' + (historialUsuario?.porcentajeAciertos || 0) + ' por ciento'">{{ historialUsuario?.porcentajeAciertos || 0 }}%</h2>
            <p class="text-muted">Respuestas correctas</p>
          </div>
        </div>
      </div>

      <!-- Progress Section -->
      <div class="row mb-4">
        <div class="col-md-8">
          <div class="dashboard-card">
            <h5>Mi Progreso</h5>
            <div class="progress mb-3" style="height: 20px;">
              <div class="progress-bar" 
                   role="progressbar" 
                   [style.width.%]="progressData.porcentajeProgreso"
                   [attr.aria-valuenow]="progressData.porcentajeProgreso"
                   aria-valuemin="0" 
                   aria-valuemax="100">
                {{ progressData.porcentajeProgreso.toFixed(1) }}%
              </div>
            </div>
            <p class="text-muted">
              Has completado {{ progressData.retosResueltos }} de {{ progressData.totalRetos }} retos disponibles
            </p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="dashboard-card" role="region" aria-labelledby="acciones-heading">
            <h5 id="acciones-heading">Acciones Rápidas</h5>
            <div class="d-grid gap-2">
              <button class="btn btn-primary" routerLink="/retos" aria-label="Navegar a la sección de retos">
                Ver Retos
              </button>
              <button class="btn btn-outline-primary" routerLink="/capsulas" aria-label="Navegar a la sección de cápsulas educativas">
                Ver Cápsulas
              </button>
              <button class="btn btn-outline-secondary" routerLink="/historial" aria-label="Ver mi historial de actividad">
                Mi Historial
              </button>
              <button class="btn btn-success" routerLink="/ioemprendo" aria-label="Ir a iOEmprendo - Simulador de Negocios">
                <i class="fas fa-store me-2"></i>
                iOEmprendo
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="row">
        <div class="col-12">
          <div class="dashboard-card">
            <h5>Actividad Reciente</h5>
            <div *ngIf="historialUsuario?.respuestas?.length; else noActivity">
              <div class="row">
                <div class="col-md-6" *ngFor="let respuesta of historialUsuario?.respuestas?.slice(0, 4)">
                  <div class="card mb-3">
                    <div class="card-body">
                      <h6 class="card-title">{{ respuesta.reto.titulo }}</h6>
                      <p class="card-text">{{ respuesta.reto.descripcion | slice:0:100 }}...</p>
                      <div class="d-flex justify-content-between align-items-center">
                        <span class="badge" [class]="respuesta.esCorrecta ? 'bg-success' : 'bg-danger'">
                          {{ respuesta.esCorrecta ? 'Correcto' : 'Incorrecto' }}
                        </span>
                        <small class="text-muted">{{ respuesta.fechaRespuesta | date:'short' }}</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noActivity>
              <div class="empty-state">
                <i class="fas fa-chart-line"></i>
                <h5>No hay actividad reciente</h5>
                <p>Comienza a resolver retos para ver tu actividad aquí</p>
                <button class="btn btn-primary" routerLink="/retos">Ir a Retos</button>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Dashboard -->
    <div *ngIf="isAdmin()">
      <div class="row mb-4">
        <!-- System Stats -->
        <div class="col-md-3">
          <div class="stats-card">
            <h5>Total Usuarios</h5>
            <h2 class="text-primary">{{ usuarioStats?.totalUsuarios || 0 }}</h2>
            <p class="text-muted">Usuarios registrados</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card">
            <h5>Emprendedores</h5>
            <h2 class="text-success">{{ usuarioStats?.emprendedores || 0 }}</h2>
            <p class="text-muted">Usuarios emprendedores</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card">
            <h5>Total Retos</h5>
            <h2 class="text-info">{{ retoStats?.totalRetos || 0 }}</h2>
            <p class="text-muted">Retos creados</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card">
            <h5>Respuestas</h5>
            <h2 class="text-warning">{{ retoStats?.totalRespuestas || 0 }}</h2>
            <p class="text-muted">Respuestas totales</p>
          </div>
        </div>
      </div>

      <!-- Admin Actions -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="dashboard-card">
            <h5>Gestión de Retos</h5>
            <p class="text-muted">Crear, editar y administrar retos del sistema</p>
            <div class="d-grid gap-2">
              <button class="btn btn-primary" routerLink="/admin/retos">
                Gestionar Retos
              </button>
              <button class="btn btn-outline-primary" routerLink="/admin/retos/nuevo">
                Crear Nuevo Reto
              </button>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="dashboard-card">
            <h5>Gestión de Usuarios</h5>
            <p class="text-muted">Administrar usuarios y roles del sistema</p>
            <div class="d-grid gap-2">
              <button class="btn btn-success" routerLink="/usuarios">
                Gestionar Usuarios
              </button>
              <button class="btn btn-outline-success" routerLink="/usuarios/nuevo">
                Crear Usuario
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- System Performance -->
      <div class="row">
        <div class="col-md-8">
          <div class="dashboard-card">
            <h5>Rendimiento del Sistema</h5>
            <div class="row">
              <div class="col-md-6">
                <h6>Efectividad de Retos</h6>
                <div class="progress mb-3">
                  <div class="progress-bar bg-success" 
                       [style.width.%]="retoStats?.porcentajeAciertos || 0"
                       role="progressbar">
                    {{ retoStats?.porcentajeAciertos || 0 }}%
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <h6>Nivel Promedio</h6>
                <div class="progress mb-3">
                  <div class="progress-bar bg-info" 
                       [style.width.%]="(usuarioStats?.nivelPromedio || 0) * 10"
                       role="progressbar">
                    {{ usuarioStats?.nivelPromedio || 0 }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="dashboard-card">
            <h5>Acciones Administrativas</h5>
            <div class="d-grid gap-2">
              <button class="btn btn-outline-primary" routerLink="/admin/estadisticas">
                Ver Estadísticas
              </button>
              <button class="btn btn-outline-info" routerLink="/admin/respuestas">
                Revisar Respuestas
              </button>
              <button class="btn btn-outline-warning" routerLink="/capsulas">
                Gestionar Cápsulas
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
