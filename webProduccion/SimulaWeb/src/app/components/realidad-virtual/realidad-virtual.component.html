<div class="vr-container">
  <!-- Header informativo -->
  <div class="vr-header">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h2><i class="bi bi-headset-vr"></i> Simulación de Tienda Virtual</h2>
          <p class="mb-0">Explora tu negocio en realidad virtual. Usa el mouse para moverte o activa el modo VR si tienes un dispositivo compatible.</p>
        </div>
        <div class="col-md-4 text-end">
          <div class="vr-status" *ngIf="!isLoading">
            <span class="badge" [ngClass]="isVRSupported ? 'bg-success' : 'bg-warning'">
              <i class="bi" [ngClass]="isVRSupported ? 'bi-check-circle' : 'bi-exclamation-circle'"></i>
              {{ isVRSupported ? 'VR Disponible' : 'Solo Vista 3D' }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pantalla de carga -->
  <div class="loading-screen" *ngIf="isLoading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3">Preparando tu tienda virtual...</p>
  </div>

  <!-- Escena A-Frame -->
  <div class="vr-scene-container" [class.hidden]="isLoading">
    <a-scene
      embedded
      loading-screen="enabled: false"
      vr-mode-ui="enabled: true"
      cursor="rayOrigin: mouse"
      wasd-controls="acceleration: 20">
      
      <!-- Assets -->
      <a-assets>
        <!-- Definir texturas y colores -->
        <img id="floor-texture" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==" crossorigin="anonymous">
      </a-assets>

      <!-- Iluminación -->
      <a-light type="ambient" color="#BBB"></a-light>
      <a-light type="directional" color="#FFF" intensity="0.6" position="-0.5 1 1"></a-light>

      <!-- Cielo -->
      <a-sky color="#ECECEC"></a-sky>

      <!-- Piso de la tienda -->
      <a-plane 
        position="0 0 -4" 
        rotation="-90 0 0" 
        width="12" 
        height="12" 
        color="#7BC8A4"
        shadow="receive: true">
      </a-plane>

      <!-- Paredes -->
      <!-- Pared trasera -->
      <a-box 
        position="0 3 -10" 
        width="12" 
        height="6" 
        depth="0.3" 
        color="#f5f5f5"
        shadow>
      </a-box>

      <!-- Pared izquierda -->
      <a-box 
        position="-6 3 -4" 
        rotation="0 90 0"
        width="12" 
        height="6" 
        depth="0.3" 
        color="#f5f5f5"
        shadow>
      </a-box>

      <!-- Pared derecha -->
      <a-box 
        position="6 3 -4" 
        rotation="0 90 0"
        width="12" 
        height="6" 
        depth="0.3" 
        color="#f5f5f5"
        shadow>
      </a-box>

      <!-- Pared frontal con entrada -->
      <!-- Parte izquierda de la pared frontal -->
      <a-box 
        position="-3.5 3 2" 
        width="5" 
        height="6" 
        depth="0.3" 
        color="#f5f5f5"
        shadow>
      </a-box>

      <!-- Parte derecha de la pared frontal -->
      <a-box 
        position="3.5 3 2" 
        width="5" 
        height="6" 
        depth="0.3" 
        color="#f5f5f5"
        shadow>
      </a-box>

      <!-- Parte superior de la entrada -->
      <a-box 
        position="0 5 2" 
        width="2" 
        height="2" 
        depth="0.3" 
        color="#f5f5f5"
        shadow>
      </a-box>

      <!-- Cartel de bienvenida -->
      <a-entity
        position="0 4 2.2"
        geometry="primitive: plane; width: 3; height: 0.8"
        material="color: #2c3e50"
        text="value: Bienvenido a tu negocio simulado; 
              align: center; 
              width: 6; 
              color: white;
              font: dejavu">
      </a-entity>

      <!-- Mostrador -->
      <a-box 
        position="0 0.5 -2" 
        width="3" 
        height="1" 
        depth="1.5" 
        color="#8B4513"
        shadow>
      </a-box>

      <!-- Caja registradora en el mostrador -->
      <a-box 
        position="0 1.1 -2" 
        width="0.5" 
        height="0.3" 
        depth="0.4" 
        color="#333333"
        shadow>
      </a-box>

      <!-- Estante izquierdo -->
      <a-box 
        position="-4 1 -5" 
        width="2" 
        height="2" 
        depth="0.5" 
        color="#D2691E"
        shadow>
      </a-box>

      <!-- Productos en estante izquierdo -->
      <a-box position="-4.5 1.5 -4.7" width="0.3" height="0.4" depth="0.3" color="#FF6347"></a-box>
      <a-box position="-4 1.5 -4.7" width="0.3" height="0.4" depth="0.3" color="#4169E1"></a-box>
      <a-box position="-3.5 1.5 -4.7" width="0.3" height="0.4" depth="0.3" color="#32CD32"></a-box>
      <a-box position="-4.5 0.5 -4.7" width="0.3" height="0.4" depth="0.3" color="#FFD700"></a-box>
      <a-box position="-4 0.5 -4.7" width="0.3" height="0.4" depth="0.3" color="#FF1493"></a-box>
      <a-box position="-3.5 0.5 -4.7" width="0.3" height="0.4" depth="0.3" color="#00CED1"></a-box>

      <!-- Estante derecho -->
      <a-box 
        position="4 1 -5" 
        width="2" 
        height="2" 
        depth="0.5" 
        color="#D2691E"
        shadow>
      </a-box>

      <!-- Productos en estante derecho -->
      <a-cylinder position="4.5 1.5 -4.7" radius="0.15" height="0.4" color="#FF8C00"></a-cylinder>
      <a-cylinder position="4 1.5 -4.7" radius="0.15" height="0.4" color="#9370DB"></a-cylinder>
      <a-cylinder position="3.5 1.5 -4.7" radius="0.15" height="0.4" color="#20B2AA"></a-cylinder>
      <a-cylinder position="4.5 0.5 -4.7" radius="0.15" height="0.4" color="#DC143C"></a-cylinder>
      <a-cylinder position="4 0.5 -4.7" radius="0.15" height="0.4" color="#00FA9A"></a-cylinder>
      <a-cylinder position="3.5 0.5 -4.7" radius="0.15" height="0.4" color="#FF69B4"></a-cylinder>

      <!-- Letreros de productos -->
      <a-text 
        value="Productos" 
        position="-4 2.3 -4.7" 
        align="center" 
        color="#000000"
        width="4">
      </a-text>

      <a-text 
        value="Ofertas" 
        position="4 2.3 -4.7" 
        align="center" 
        color="#FF0000"
        width="4">
      </a-text>

      <!-- Cámara del usuario con controles -->
      <a-entity 
        id="cameraRig" 
        position="0 1.6 4"
        movement-controls="constrainToNavMesh: false; fly: false"
        look-controls>
        <a-entity 
          camera 
          position="0 0 0"
          wasd-controls-enabled="true">
          <a-cursor 
            animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
            animation__fusing="property: scale; startEvents: cursor-fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
            raycaster="objects: .clickable"
            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
            material="color: black; shader: flat">
          </a-cursor>
        </a-entity>
      </a-entity>
    </a-scene>
  </div>

  <!-- Controles e instrucciones -->
  <div class="vr-controls" [class.hidden]="isLoading">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="controls-info">
            <h5>Controles:</h5>
            <ul class="list-inline mb-0">
              <li class="list-inline-item"><i class="bi bi-mouse"></i> Mouse: Mirar alrededor</li>
              <li class="list-inline-item"><i class="bi bi-keyboard"></i> WASD: Moverte</li>
              <li class="list-inline-item"><i class="bi bi-headset-vr"></i> Click en VR: Entrar en modo VR</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
